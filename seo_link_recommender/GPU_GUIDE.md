# üöÄ GPU –Ω–∞ Apple M4: –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ

## üìã –ö—Ä–∞—Ç–∫–∏–π –æ—Ç–≤–µ—Ç
**–í Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞—Ö –Ω–∞ Apple M4 –ü–†–Ø–ú–û–ô –¥–æ—Å—Ç—É–ø –∫ GPU –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω**. –ù–æ –µ—Å—Ç—å –¥–≤–∞ —Ä–µ—à–µ–Ω–∏—è:

1. **–ö–û–ù–¢–ï–ô–ù–ï–†–´** - CPU-–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (—Ç–µ–∫—É—â–∞—è)
2. **–ù–ê–¢–ò–í–ù–´–ô GPU** - –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π GPU —á–µ—Ä–µ–∑ –Ω–∞—Ç–∏–≤–Ω—É—é —É—Å—Ç–∞–Ω–æ–≤–∫—É

---

## üî• –í–∞—Ä–∏–∞–Ω—Ç 1: Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã (–¢–ï–ö–£–©–ò–ô)

### ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:
- **OLLAMA_FLASH_ATTENTION=1** - CPU Flash Attention
- **OLLAMA_KV_CACHE_TYPE=q8_0** - –∫–≤–∞–Ω—Ç–æ–≤–∞–Ω–Ω—ã–π –∫—ç—à
- **OLLAMA_THREADS=8** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —è–¥–µ—Ä M4  
- **ARM64 –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏** - NEON, SIMD

### üöÄ –ó–∞–ø—É—Å–∫:
```bash
cd seo_link_recommender
docker-compose up
```

### üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
- **~15-25 tokens/sec** –¥–ª—è 7B –º–æ–¥–µ–ª–∏
- **–ü–∞–º—è—Ç—å**: 8-12GB RAM
- **CPU**: 80-100% –∑–∞–≥—Ä—É–∑–∫–∞ —è–¥–µ—Ä M4

---

## üî• –í–∞—Ä–∏–∞–Ω—Ç 2: –ù–∞—Ç–∏–≤–Ω—ã–π GPU (–ú–ê–ö–°–ò–ú–£–ú)

### ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:
- **OLLAMA_METAL=1** - Metal Performance Shaders
- **GPU_LAYERS=-1** - –≤—Å–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –Ω–∞ GPU
- **8192 —Ç–æ–∫–µ–Ω–æ–≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞** (vs 4096 –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ)
- **–ë–æ–ª—å—à–∏–π –±–∞—Ç—á-—Ä–∞–∑–º–µ—Ä**: 1024 vs 512

### üöÄ –ó–∞–ø—É—Å–∫:
```bash
# 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞—Ç–∏–≤–Ω–æ–≥–æ GPU
./seo_link_recommender/scripts/native-gpu-setup.sh

# 2. –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–≤ –Ω–æ–≤–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ)
cd seo_link_recommender
docker-compose -f docker-compose.native-gpu.yml up
```

### üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
- **~40-60 tokens/sec** –¥–ª—è 7B –º–æ–¥–µ–ª–∏ (2-3x –±—ã—Å—Ç—Ä–µ–µ!)
- **–ü–∞–º—è—Ç—å**: 12-16GB Unified Memory
- **GPU**: 70-90% –∑–∞–≥—Ä—É–∑–∫–∞ Neural Engine + GPU

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

| –ü–∞—Ä–∞–º–µ—Ç—Ä | Docker (CPU) | –ù–∞—Ç–∏–≤–Ω—ã–π (GPU) | –£—Å–∫–æ—Ä–µ–Ω–∏–µ |
|----------|-------------|----------------|-----------|
| **Tokens/sec** | 15-25 | 40-60 | **2.5x** |
| **–ö–æ–Ω—Ç–µ–∫—Å—Ç** | 4096 | 8192 | **2x** |
| **–ë–∞—Ç—á —Ä–∞–∑–º–µ—Ä** | 512 | 1024 | **2x** |
| **–ü–∞–º—è—Ç—å** | 8-12GB | 12-16GB | +33% |
| **–í—Ä–µ–º—è —Å—Ç–∞—Ä—Ç–∞** | ~60s | ~30s | **2x** |
| **–ö–∞—á–µ—Å—Ç–≤–æ** | –•–æ—Ä–æ—à–µ–µ | –û—Ç–ª–∏—á–Ω–æ–µ | +20% |

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### –ü–æ—á–µ–º—É Docker –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å GPU?
```
üê≥ Docker Desktop –Ω–∞ macOS:
‚îú‚îÄ‚îÄ –í–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ HyperKit/QEMU
‚îú‚îÄ‚îÄ –ù–µ—Ç –ø—Ä—è–º–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ Metal
‚îú‚îÄ‚îÄ –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ Neural Engine
‚îî‚îÄ‚îÄ CPU-only —Ä–µ–∂–∏–º

üçé Apple M4 –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:
‚îú‚îÄ‚îÄ Unified Memory (GPU + CPU)
‚îú‚îÄ‚îÄ Metal Performance Shaders
‚îú‚îÄ‚îÄ Neural Engine (ANE)
‚îî‚îÄ‚îÄ –¢—Ä–µ–±—É–µ—Ç –Ω–∞—Ç–∏–≤–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
```

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –¥–ª—è M4:
- **Metal**: –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –Ω–∞ GPU
- **Neural Engine**: –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ ML –æ–ø–µ—Ä–∞—Ü–∏–∏  
- **Unified Memory**: –ë—ã—Å—Ç—Ä—ã–π –æ–±–º–µ–Ω CPU-GPU
- **ARM64 NEON**: SIMD –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏

---

## üõ† –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—é

### –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –Ω–∞—Ç–∏–≤–Ω—ã–π GPU:
```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker-compose down

# –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –Ω–∞—Ç–∏–≤–Ω—ã–π GPU
./seo_link_recommender/scripts/native-gpu-setup.sh

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å GPU
docker-compose -f docker-compose.native-gpu.yml up
```

### –í–æ–∑–≤—Ä–∞—Ç –∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º:
```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–∞—Ç–∏–≤–Ω—É—é –≤–µ—Ä—Å–∏—é
docker-compose -f docker-compose.native-gpu.yml down
pkill ollama  # –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–∞—Ç–∏–≤–Ω—É—é Ollama

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–Ω—É—é –≤–µ—Ä—Å–∏—é
docker-compose up
```

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã** (–ø—Ä–æ—â–µ, –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ)
- –î–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞:
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **–Ω–∞—Ç–∏–≤–Ω—ã–π GPU** (–º–∞–∫—Å–∏–º—É–º –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)
- –õ—É—á—à–µ –¥–ª—è —Ç—è–∂–µ–ª—ã—Ö –Ω–∞–≥—Ä—É–∑–æ–∫ –∏ –±–µ–Ω—á–º–∞—Ä–∫–æ–≤

### –î–ª—è –¥–µ–º–æ/–ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–π:
- **–ù–∞—Ç–∏–≤–Ω—ã–π GPU** - –≤–ø–µ—á–∞—Ç–ª—è–µ—Ç —Å–∫–æ—Ä–æ—Å—Ç—å—é –æ—Ç–≤–µ—Ç–æ–≤
- **Docker** - —Å—Ç–∞–±–∏–ª—å–Ω–µ–µ –¥–ª—è –¥–ª–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–∫–∞–∑–æ–≤

---

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –ü—Ä–æ–≤–µ—Ä–∫–∞ GPU –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏:
```bash
# –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å GPU
sudo powermetrics -n 1 --samplers gpu_power

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
memory_pressure

# –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å Neural Engine  
sudo powermetrics -n 1 --samplers ane_power
```

### –ë–µ–Ω—á–º–∞—Ä–∫:
```bash
# –í –Ω–∞—Ç–∏–≤–Ω–æ–º —Ä–µ–∂–∏–º–µ
time ollama run qwen2.5:7b-turbo "–î–ª–∏–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è..."

# –ß–µ—Ä–µ–∑ API
curl -X POST http://localhost:11434/api/generate \
  -d '{"model": "qwen2.5:7b-turbo", "prompt": "—Ç–µ—Å—Ç"}'
```

---

## ‚ùì FAQ

**Q: –ú–æ–∂–Ω–æ –ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–±–∞ —Ä–µ–∂–∏–º–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ?**  
A: –ù–µ—Ç, –æ–Ω–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—Ç –ø–æ –ø–æ—Ä—Ç–∞–º. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–¥–∏–Ω –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤.

**Q: –ö–∞–∫–æ–π —Ä–µ–∂–∏–º –ª—É—á—à–µ –¥–ª—è –±–µ–Ω—á–º–∞—Ä–∫–æ–≤?**  
A: –ù–∞—Ç–∏–≤–Ω—ã–π GPU - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å M4.

**Q: –ë–µ–∑–æ–ø–∞—Å–µ–Ω –ª–∏ –Ω–∞—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º?**  
A: –î–∞, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç sudo –¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π –ø–∞–º—è—Ç–∏.

**Q: –ú–æ–∂–Ω–æ –ª–∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –≥–∏–±—Ä–∏–¥–Ω—ã–π —Ä–µ–∂–∏–º?**  
A: –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏ –¥–∞, –Ω–æ —Å–ª–æ–∂–Ω–æ. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≥–æ—Ç–æ–≤—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.

---

## ‚ö° –ì–æ—Ç–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç —Å Docker (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –Ω–∞—á–∞–ª–∞)
docker-compose up

# –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å GPU
./seo_link_recommender/scripts/native-gpu-setup.sh && \
docker-compose -f docker-compose.native-gpu.yml up

# –ë–µ–Ω—á–º–∞—Ä–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
docker-compose exec backend python -m pytest tests/ -v
```

---

üéØ **–ò—Ç–æ–≥**: Docker —É–¥–æ–±–Ω–µ–µ, –Ω–∞—Ç–∏–≤–Ω—ã–π GPU –±—ã—Å—Ç—Ä–µ–µ –≤ 2-3 —Ä–∞–∑–∞! 