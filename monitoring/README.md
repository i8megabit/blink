# üìä Monitoring - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–ª–µ—Ä—Ç—ã reLink

–°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –∞–ª–µ—Ä—Ç–æ–≤ –¥–ª—è –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã reLink —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π Prometheus, Grafana –∏ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
# –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker Compose
docker-compose up -d

# –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
pip install -r requirements.txt
uvicorn app.main:app --reload --port 8003

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
pytest tests/
```

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫
- **FastAPI** - –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è API
- **Prometheus** - —Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫
- **Grafana** - –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- **SQLAlchemy** - ORM –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î
- **Redis** - –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—á–µ—Ä–µ–¥–∏
- **AlertManager** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–ª–µ—Ä—Ç–∞–º–∏

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```
app/
‚îú‚îÄ‚îÄ main.py              # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ config.py            # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ database.py          # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
‚îú‚îÄ‚îÄ models.py            # –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ services.py          # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îú‚îÄ‚îÄ monitoring.py        # –û—Å–Ω–æ–≤–Ω–æ–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
‚îî‚îÄ‚îÄ api/
    ‚îî‚îÄ‚îÄ routes.py        # API —Ä–æ—É—Ç—ã

tests/
‚îú‚îÄ‚îÄ test_api.py          # API —Ç–µ—Å—Ç—ã
‚îî‚îÄ‚îÄ test_services.py     # –¢–µ—Å—Ç—ã —Å–µ—Ä–≤–∏—Å–æ–≤

prometheus.yml           # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Prometheus
```

## üéØ –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

### –°–±–æ—Ä –º–µ—Ç—Ä–∏–∫
- –°–∏—Å—Ç–µ–º–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ (CPU, –ø–∞–º—è—Ç—å, –¥–∏—Å–∫)
- –ü—Ä–∏–∫–ª–∞–¥–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ (API, –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö)
- –ë–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫–∏ (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏)
- –ö–∞—Å—Ç–æ–º–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏—Ö –∑–∞–¥–∞—á

### –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è
- –î–∞—à–±–æ—Ä–¥—ã Grafana
- –†–µ–∞–ª-—Ç–∞–π–º –≥—Ä–∞—Ñ–∏–∫–∏
- –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ
- –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

### –ê–ª–µ—Ä—Ç—ã
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –ø–æ—Ä–æ–≥–∏
- –≠—Å–∫–∞–ª–∞—Ü–∏—è –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏

### –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
- –¢—Ä–µ–Ω–¥—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º
- –ê–Ω–∞–ª–∏–∑ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤
- –û—Ç—á–µ—Ç—ã –∏ —ç–∫—Å–ø–æ—Ä—Ç

## üîß –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –ö–æ–º–∞–Ω–¥—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
```bash
# –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞
uvicorn app.main:app --reload --port 8003

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
pytest tests/ -v

# –ó–∞–ø—É—Å–∫ —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º
pytest --cov=app tests/

# –õ–∏–Ω—Ç–∏–Ω–≥
flake8 app/
black app/
isort app/
```

### –°–æ–∑–¥–∞–Ω–∏–µ –º–µ—Ç—Ä–∏–∫
```python
from app.monitoring import MetricsCollector

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–ª–ª–µ–∫—Ç–æ—Ä–∞
collector = MetricsCollector()

# –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Å—Ç–æ–º–Ω–æ–π –º–µ—Ç—Ä–∏–∫–∏
collector.create_counter("api_requests_total", "Total API requests")
collector.create_gauge("active_users", "Number of active users")
collector.create_histogram("response_time", "API response time")
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### Unit —Ç–µ—Å—Ç—ã
```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
pytest

# –ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞
pytest tests/test_api.py::test_health_check

# –ó–∞–ø—É—Å–∫ —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º
pytest --cov=app tests/
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
```bash
# –¢–µ—Å—Ç—ã —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏
pytest tests/integration/

# –¢–µ—Å—Ç—ã API
pytest tests/api/
```

## üê≥ Docker

### –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞
```bash
# –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞
docker build -t relink-monitoring .

# –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker run -p 8003:8003 relink-monitoring
```

### Docker Compose
```bash
# –ó–∞–ø—É—Å–∫ —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
docker-compose up -d

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose logs -f monitoring
```

## üìä API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### Swagger UI
- **–õ–æ–∫–∞–ª—å–Ω–æ**: http://localhost:8003/docs
- **ReDoc**: http://localhost:8003/redoc

### –û—Å–Ω–æ–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
- `GET /health` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
- `GET /metrics` - –º–µ—Ç—Ä–∏–∫–∏ Prometheus
- `GET /alerts` - –∞–∫—Ç–∏–≤–Ω—ã–µ –∞–ª–µ—Ä—Ç—ã
- `POST /alerts/configure` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–ª–µ—Ä—Ç–æ–≤

## üìà Prometheus –º–µ—Ç—Ä–∏–∫–∏

### –°–∏—Å—Ç–µ–º–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
```yaml
# CPU –∏ –ø–∞–º—è—Ç—å
node_cpu_seconds_total
node_memory_MemAvailable_bytes
node_filesystem_avail_bytes

# –°–µ—Ç—å
node_network_receive_bytes_total
node_network_transmit_bytes_total
```

### –ü—Ä–∏–∫–ª–∞–¥–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
```yaml
# API –º–µ—Ç—Ä–∏–∫–∏
http_requests_total
http_request_duration_seconds
http_requests_in_flight

# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
db_connections_active
db_queries_total
db_query_duration_seconds
```

### –ë–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫–∏
```yaml
# –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
active_users_total
user_registrations_total
user_sessions_total

# –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
transactions_total
transaction_amount_total
transaction_success_rate
```

## üé® Grafana –¥–∞—à–±–æ—Ä–¥—ã

### –°–∏—Å—Ç–µ–º–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
- –°–µ—Ç–µ–≤–æ–π —Ç—Ä–∞—Ñ–∏–∫
- –î–∏—Å–∫–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

### –ü—Ä–∏–∫–ª–∞–¥–Ω–æ–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- API –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –û—à–∏–±–∫–∏ –∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è
- –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞
- –ü—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å

### –ë–∏–∑–Ω–µ—Å-–∞–Ω–∞–ª–∏—Ç–∏–∫–∞
- –ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- –ö–æ–Ω–≤–µ—Ä—Å–∏—è
- –¢—Ä–µ–Ω–¥—ã —Ä–æ—Å—Ç–∞

## üîî –ê–ª–µ—Ä—Ç—ã

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–ª–µ—Ä—Ç–æ–≤
```yaml
# prometheus.yml
groups:
  - name: system_alerts
    rules:
      - alert: HighCPUUsage
        expr: 100 - (avg by(instance) (irate(node_cpu_seconds_total{mode="idle"}[5m])) * 100) > 80
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High CPU usage detected"
          description: "CPU usage is above 80% for 5 minutes"
```

### –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- Slack –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- Telegram –±–æ—Ç
- Webhook —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

## üîó –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### Prometheus
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫
- Service discovery
- Scraping –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- –•—Ä–∞–Ω–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤

### Grafana
- –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –º–µ—Ç—Ä–∏–∫
- –î–∞—à–±–æ—Ä–¥—ã
- –ê–ª–µ—Ä—Ç—ã
- –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö

### AlertManager
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–ª–µ—Ä—Ç–∞–º–∏
- –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –≠—Å–∫–∞–ª–∞—Ü–∏—è
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏

## üöÄ –î–µ–ø–ª–æ–π

### –ü—Ä–æ–¥–∞–∫—à–µ–Ω
```bash
# –°–±–æ—Ä–∫–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω –æ–±—Ä–∞–∑–∞
docker build -t relink-monitoring:prod .

# –ó–∞–ø—É—Å–∫ —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è
docker run -e DATABASE_URL=... relink-monitoring:prod
```

### CI/CD
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–±–æ—Ä–∫–∞ –ø—Ä–∏ push
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π –≤ staging

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://api.relink.dev)
- [Prometheus –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è](prometheus.yml)
- [Grafana –¥–∞—à–±–æ—Ä–¥—ã](grafana/dashboards/) 