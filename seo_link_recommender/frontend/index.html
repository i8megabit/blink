<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SEO Link Recommender</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css" />
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
</head>
<body>
  <div id="app"></div>
  <script type="text/babel">
    function App() {
      const [text, setText] = React.useState('');
      const [domain, setDomain] = React.useState('');
      const [links, setLinks] = React.useState([]);
      const [history, setHistory] = React.useState([]);
      const [error, setError] = React.useState('');

      React.useEffect(() => { loadHistory(); }, []);

      async function loadHistory() {
        const resp = await fetch('http://localhost:8000/api/v1/recommendations');
        const data = await resp.json();
        setHistory(data);
      }

      async function sendText() {
        if (!text.trim()) { setError('Поле не может быть пустым'); return; }
        setError('');
        const resp = await fetch('http://localhost:8000/api/v1/recommend', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ text })
        });
        if (!resp.ok) { setError('Ошибка'); return; }
        const data = await resp.json();
        setLinks(data.links.map(l => ({ from: '', to: l, anchor: l })));
        await loadHistory();
      }

      async function sendDomain() {
        if (!domain.trim()) { setError('Поле не может быть пустым'); return; }
        setError('');
        const resp = await fetch('http://localhost:8000/api/v1/wp_recommend', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ domain })
        });
        if (!resp.ok) { setError('Ошибка'); return; }
        const data = await resp.json();
        setLinks(data.recommendations || []);
      }

      return (
        <section className="section">
          <div className="container">
            <h1 className="title has-text-centered">SEO Link Recommender</h1>
            <div className="box">
              <div className="field">
                <label className="label">Текст</label>
                <div className="control">
                  <textarea className="textarea" rows="4" value={text} onChange={e => setText(e.target.value)}></textarea>
                </div>
                <button className="button is-link mt-2" onClick={sendText}>Получить ссылки</button>
              </div>
              <div className="field mt-4">
                <label className="label">WordPress сайт</label>
                <div className="control">
                  <input className="input" placeholder="example.com" value={domain} onChange={e => setDomain(e.target.value)} />
                </div>
                <button className="button is-primary mt-2" onClick={sendDomain}>Анализ WordPress</button>
              </div>
              {error && <p className="has-text-danger mt-2">{error}</p>}
            </div>
            <div className="content">
              <h2>Рекомендации</h2>
              <table className="table is-striped is-fullwidth">
                <thead>
                  <tr><th>Откуда</th><th>Куда</th><th>Анкор</th></tr>
                </thead>
                <tbody>
                  {links.map((l, i) => (
                    <tr key={i}>
                      <td>{l.from ? <a href={l.from} target="_blank">{l.from}</a> : ''}</td>
                      <td>{l.to ? <a href={l.to} target="_blank">{l.to}</a> : ''}</td>
                      <td>{l.anchor}</td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
            <div className="content">
              <h2>История</h2>
              <ul>
                {history.map(h => (
                  <li key={h.id}>{h.text} → {(h.links || []).join(', ')}</li>
                ))}
              </ul>
            </div>
          </div>
        </section>
      );
    }

    ReactDOM.createRoot(document.getElementById('app')).render(<App />);
  </script>
</body>
</html>
