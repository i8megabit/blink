<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SEO Link Recommender - No Babel</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css" />
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <!-- Убираем Babel! -->
  <style>
    /* Тот же CSS что и раньше */
    .hero-apple {
      background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
      color: white;
      padding: 40px 20px;
      text-align: center;
    }
    
    .btn-apple {
      padding: 12px 24px;
      margin: 8px;
      border: none;
      border-radius: 8px;
      background: #007AFF;
      color: white;
      cursor: pointer;
    }
    
    .card {
      background: white;
      border-radius: 12px;
      padding: 20px;
      margin: 20px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body>
  <div id="app"></div>
  
  <script>
    // React без JSX - используем createElement
    const { useState, useEffect, createElement: h } = React;
    
    function App() {
      const [domain, setDomain] = useState('');
      const [currentView, setCurrentView] = useState('domains');
      const [domains, setDomains] = useState([]);
      
      useEffect(() => {
        console.log('🚀 SEO Link Recommender загружен БЕЗ Babel!');
        loadDomains();
      }, []);
      
      async function loadDomains() {
        try {
          const response = await fetch('/api/v1/domains');
          const data = await response.json();
          setDomains(data.domains || []);
        } catch (error) {
          console.error('Ошибка загрузки доменов:', error);
        }
      }
      
      async function handleAnalyzeDomain() {
        if (!domain.trim()) return;
        
        try {
          const response = await fetch('/api/v1/wp_index', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              domain: domain.trim(),
              comprehensive: true
            })
          });
          
          const result = await response.json();
          console.log('Результат анализа:', result);
          loadDomains(); // Обновляем список доменов
        } catch (error) {
          console.error('Ошибка анализа:', error);
        }
      }
      
      // Компоненты без JSX
      const Header = () => h('div', { className: 'hero-apple' },
        h('h1', { className: 'title' }, '🔗 SEO Link Recommender'),
        h('p', { className: 'subtitle' }, 'Интеллектуальная генерация внутренних ссылок')
      );
      
      const DomainInput = () => h('div', { className: 'card' },
        h('h2', { className: 'subtitle' }, 'Анализ нового домена'),
        h('div', { className: 'field has-addons' },
          h('div', { className: 'control is-expanded' },
            h('input', {
              className: 'input',
              type: 'text',
              placeholder: 'example.com',
              value: domain,
              onChange: (e) => setDomain(e.target.value),
              onKeyPress: (e) => e.key === 'Enter' && handleAnalyzeDomain()
            })
          ),
          h('div', { className: 'control' },
            h('button', {
              className: 'btn-apple',
              onClick: handleAnalyzeDomain,
              disabled: !domain.trim()
            }, '🚀 Анализировать')
          )
        )
      );
      
      const DomainsList = () => h('div', { className: 'card' },
        h('h2', { className: 'subtitle' }, `📊 Проиндексированные домены (${domains.length})`),
        domains.length === 0 
          ? h('p', { className: 'has-text-grey' }, 'Пока нет проиндексированных доменов')
          : h('div', { className: 'content' },
              domains.map(domain => 
                h('div', { 
                  key: domain.id,
                  className: 'box',
                  style: { marginBottom: '12px' }
                },
                  h('div', { style: { display: 'flex', justifyContent: 'space-between', alignItems: 'center' } },
                    h('div', null,
                      h('strong', null, domain.display_name),
                      h('br'),
                      h('small', { className: 'has-text-grey' }, 
                        `${domain.total_posts} статей | ${domain.total_analyses} анализов`
                      )
                    ),
                    h('button', {
                      className: 'btn-apple',
                      onClick: () => handleAnalyzeDomain()
                    }, '🔄 Переанализировать')
                  )
                )
              )
            )
      );
      
      // Главный компонент
      return h('div', null,
        Header(),
        h('div', { className: 'container', style: { padding: '20px' } },
          DomainInput(),
          DomainsList()
        )
      );
    }
    
    // Рендерим приложение БЕЗ Babel
    const root = ReactDOM.createRoot(document.getElementById('app'));
    root.render(h(App));
  </script>
</body>
</html> 